#!/usr/bin/env python
# coding: utf-8

# <font color='blue' size=5><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
# 
# <font color='blue'>–ü—Ä–∏–≤–µ—Ç, –°–µ—Ä–≥–µ–π! –ú–µ–Ω—è –∑–æ–≤—É—Ç –ü–∞–≤–µ–ª –ì—Ä–∏–≥–æ—Ä—å–µ–≤, –∏ —è –±—É–¥—É –ø—Ä–æ–≤–µ—Ä—è—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç.<br>–ú–æ—è –æ—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å - –Ω–µ —É–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–æ–≤–µ—Ä—à—ë–Ω–Ω—ã–µ —Ç–æ–±–æ–π –æ—à–∏–±–∫–∏, –∞ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–∏–º –æ–ø—ã—Ç–æ–º –∏ –ø–æ–º–æ—á—å —Ç–µ–±–µ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—É.<br>–°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É! –ü—Ä–µ–¥–ª–∞–≥–∞—é –æ–±—â–∞—Ç—å—Å—è –Ω–∞ ¬´—Ç—ã¬ª.</font>
# <details>
# 	<summary><u>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–º –º–æ–º–µ–Ω—Ç–∞–º (–∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ)</u></summary>
# <font color='blue'>–Ø –±—É–¥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ü–≤–µ—Ç–∞, —á—Ç–æ–±—ã –±—ã–ª–æ —É–¥–æ–±–Ω–µ–µ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å –º–æ–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</font>
# 
# 
# ---
# 
# 
# <font color='blue'>—Å–∏–Ω–∏–π —Ç–µ–∫—Å—Ç - –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è</font>
# 
# <font color='green'>‚úîÔ∏è –∏ –∑–µ–ª–µ–Ω—ã–π —Ç–µ–∫—Å—Ç - –≤—Å–µ –æ—Ç–ª–∏—á–Ω–æ</font>
# 
# <font color='orange'>‚ö†Ô∏è –∏ –æ—Ä–∞–Ω–∂–µ–≤—ã–π —Ç–µ–∫—Å—Ç - —Å–¥–µ–ª–∞–Ω–æ –≤—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –æ–¥–Ω–∞–∫–æ –µ—Å—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –Ω–∞ —á—Ç–æ —Å—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ</font>
# 
# <font color='red'>‚ùå –∏ –∫—Ä–∞—Å–Ω—ã–π —Ç–µ–∫—Å—Ç - –µ—Å—Ç—å –Ω–µ–¥–æ—á–µ—Ç—ã</font>
# 
# 
# </details>    
#     </br>
# <font color='blue'>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ —É–¥–∞–ª—è–π –º–æ–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ —Å–ª—É—á–∞–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ä–∞–±–æ—Ç—ã, —Ç–∞–∫ –±—É–¥–µ—Ç –ø—Ä–æ—â–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è, –∫–∞–∫–∏–µ –±—ã–ª–∏ –Ω–µ–¥–æ—á–µ—Ç—ã, –∞ —Ç–∞–∫–∂–µ —Å—Ä–∞–∑—É —É–≤–∏–¥–µ—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ. </font>
# 
# –û—Ç–≤–µ—Ç—ã –Ω–∞ –º–æ–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ª—É—á—à–µ —Ç–æ–∂–µ –ø–æ–º–µ—á–∞—Ç—å.
# –ù–∞–ø—Ä–∏–º–µ—Ä: <font color='purple'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞</b></font>
# 
# <font color='blue'><b>–î–∞–≤–∞–π —Å–º–æ—Ç—Ä–µ—Ç—å, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å!</b></font>

# <font color='blue' size=3><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ 2</b></font>
# 
# <font color='blue'>–ü—Ä–∏–≤–µ—Ç –µ—â–µ —Ä–∞–∑. –°–ø–∞—Å–∏–±–æ, –∑–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ —Ä–∞–±–æ—Ç–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è. –¢–æ–ª—å–∫–æ –æ–±–æ–∑–Ω–∞—á–∏–º, —á—Ç–æ —ç—Ç–æ –≤—Ç–æ—Ä–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è.</font>

# <font color='blue' size=3><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ 3</b></font>
# 
# <font color='blue'>–ü—Ä–∏–≤–µ—Ç –µ—â–µ —Ä–∞–∑. –°–ø–∞—Å–∏–±–æ, –∑–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ —Ä–∞–±–æ—Ç–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.</font>

# <h1>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ<span class="tocSkip"></span></h1>
# <div class="toc"><ul class="toc-item"><li><span><a href="#–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞" data-toc-modified-id="–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞</a></span></li><li><span><a href="#–û–±—É—á–µ–Ω–∏–µ" data-toc-modified-id="–û–±—É—á–µ–Ω–∏–µ-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>–û–±—É—á–µ–Ω–∏–µ</a></span><ul class="toc-item"><li><span><a href="#LogisticRegression" data-toc-modified-id="LogisticRegression-2.1"><span class="toc-item-num">2.1&nbsp;&nbsp;</span>LogisticRegression</a></span></li><li><span><a href="#DecisionTreeClassifier" data-toc-modified-id="DecisionTreeClassifier-2.2"><span class="toc-item-num">2.2&nbsp;&nbsp;</span>DecisionTreeClassifier</a></span></li></ul></li><li><span><a href="#–í—ã–≤–æ–¥—ã" data-toc-modified-id="–í—ã–≤–æ–¥—ã-3"><span class="toc-item-num">3&nbsp;&nbsp;</span>–í—ã–≤–æ–¥—ã</a></span></li><li><span><a href="#–ß–µ–∫-–ª–∏—Å—Ç-–ø—Ä–æ–≤–µ—Ä–∫–∏" data-toc-modified-id="–ß–µ–∫-–ª–∏—Å—Ç-–ø—Ä–æ–≤–µ—Ä–∫–∏-4"><span class="toc-item-num">4&nbsp;&nbsp;</span>–ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏</a></span></li></ul></div>

# # –ü—Ä–æ–µ–∫—Ç –¥–ª—è ¬´–í–∏–∫–∏—à–æ–ø¬ª

# –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω ¬´–í–∏–∫–∏—à–æ–ø¬ª –∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å. –¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –¥–æ–ø–æ–ª–Ω—è—Ç—å –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤, –∫–∞–∫ –≤ –≤–∏–∫–∏-—Å–æ–æ–±—â–µ—Å—Ç–≤–∞—Ö. –¢–æ –µ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç—ã –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç —Å–≤–æ–∏ –ø—Ä–∞–≤–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∏—Ä—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö. –ú–∞–≥–∞–∑–∏–Ω—É –Ω—É–∂–µ–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å —Ç–æ–∫—Å–∏—á–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∏—Ö –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é. 
# 
# –û–±—É—á–∏—Ç–µ –º–æ–¥–µ–ª—å –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –∏ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ. –í –≤–∞—à–µ–º —Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–∏ –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Å —Ä–∞–∑–º–µ—Ç–∫–æ–π –æ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏ –ø—Ä–∞–≤–æ–∫.
# 
# –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –º–æ–¥–µ–ª—å —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ *F1* –Ω–µ –º–µ–Ω—å—à–µ 0.75. 
# 
# **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –ø—Ä–æ–µ–∫—Ç–∞**
# 
# 1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ.
# 2. –û–±—É—á–∏—Ç–µ —Ä–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏. 
# 3. –°–¥–µ–ª–∞–π—Ç–µ –≤—ã–≤–æ–¥—ã.
# 
# –î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–∏–º–µ–Ω—è—Ç—å *BERT* –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å.
# 
# **–û–ø–∏—Å–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**
# 
# –î–∞–Ω–Ω—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `toxic_comments.csv`. –°—Ç–æ–ª–±–µ—Ü *text* –≤ –Ω—ë–º —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è, –∞ *toxic* ‚Äî —Ü–µ–ª–µ–≤–æ–π –ø—Ä–∏–∑–Ω–∞–∫.

# ## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

# In[1]:


get_ipython().run_line_magic('autosave', '10')


# In[2]:


get_ipython().system('pip install spacy')


# In[3]:


import pandas as pd
import re
import nltk
nltk.download('stopwords')
from nltk.corpus import stopwords as nltk_stopwords
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.linear_model import LogisticRegression
from sklearn.ensemble import RandomForestClassifier
from sklearn.tree import DecisionTreeClassifier
from sklearn.pipeline import Pipeline
from sklearn.model_selection import GridSearchCV
from sklearn.model_selection import cross_val_score, cross_val_predict
from sklearn.metrics import f1_score
import numpy as np
from sklearn import metrics
import spacy
import en_core_web_sm
from sklearn.model_selection import train_test_split
import warnings
warnings.filterwarnings('ignore')


# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞: </b></font> ‚úîÔ∏è <br>
# <font color='green'>–ó–¥–æ—Ä–æ–≤–æ, —á—Ç–æ –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –æ–¥–Ω–æ–π —è—á–µ–π–∫–µ.<br>
# –ï—Å–ª–∏ —Ö–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å –µ—â—ë –ª—É—á—à–µ, —Å–æ–±–ª—é–¥–∞–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç PEP-8, —Ä–∞–∑–±–µ–π –∏–º–ø–æ—Ä—Ç—ã –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≥—Ä—É–ø–ø—ã, —Ä–∞–∑–¥–µ–ª–∏ –≥—Ä—É–ø–ø—ã –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π. –ú–æ–∂–Ω–æ –≤ –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.<br>
# –°—Å—ã–ª–∫–∞ –¥–ª—è –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è: https://pythonworld.ru/osnovy/pep-8-rukovodstvo-po-napisaniyu-koda-na-python.html
# </font>

# In[4]:


comments = pd.read_csv('/datasets/toxic_comments.csv')
comments.head()


# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞: </b></font> ‚úîÔ∏è\
# <font color='green'>–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –ø–µ—Ä–≤–∏—á–Ω—ã–π –æ—Å–º–æ—Ç—Ä –ø—Ä–æ–≤–µ–¥–µ–Ω.</font>

# In[5]:


comments = comments.drop(columns='Unnamed: 0')


# –û—á–∏—Å—Ç–∏–º —Ç–µ–∫—Å—Ç—ã –æ—Ç —Å–∏–º–≤–æ–ª–æ–≤ –∏ –ø—Ä–∏–≤–µ–¥–µ–º –≤—Å–µ –≤ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É:

# In[6]:


def clean_data(row):
    row = re.sub(r"(?:\n|\r)", " ", row)
    row = re.sub(r"[^a-zA-Z ]+", "", row).strip()
    row = row.lower()
    return row

comments['text'] = comments['text'].apply(clean_data)
comments.head()


# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞: </b></font> ‚úîÔ∏è\
# <font color='green'> –û—á–∏—Å—Ç–∫–∞ —Å–¥–µ–ª–∞–Ω–∞ –≤–µ—Ä–Ω–æ! –ú—ã –æ—Å—Ç–∞–≤–∏–ª–∏ —Ç–æ–ª—å–∫–æ —Å–∏–º–≤–æ–ª—ã –õ–∞—Ç–∏–Ω—Å–∫–æ–≥–æ –∞–ª—Ñ–∞–≤–∏—Ç–∞ –Ω–∏–∂–Ω–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞.</font>

# In[7]:


comments.info()


# In[8]:


m = spacy.load("en_core_web_sm", disable=['parser', 'ner'])


# In[9]:


comments_corpus = comments['text'].values
def lemmatize(text):
    doc = m(text)
    return " ".join([token.lemma_ for token in doc])

for i in range(len(comments_corpus)):
    comments_corpus[i] = lemmatize(comments_corpus[i])
comments_corpus


# In[12]:


target = comments['toxic']


# In[15]:


features_train_valid, features_test, target_train_valid, target_test = train_test_split(comments_corpus, target, test_size = 0.1, random_state = 12345)
features_train, features_valid, target_train, target_valid = train_test_split(features_train_valid, target_train_valid, shuffle=False, test_size=0.25, random_state = 12345)
print(features_train.shape, features_valid.shape, features_test.shape,target_train.shape, target_valid.shape, target_test.shape)


# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ : </b></font> ‚úîÔ∏è\
# <font color='green'> –ó–¥–æ—Ä–æ–≤–æ , —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å —Ç—Ä–∏ –≤—ã–±–æ—Ä–∫–∏!</font>

# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞: </b></font> ‚ùå\
# <font color='red'><s>–ü—Ä–∏–≤–æ–¥–∏—Ç—å —Ç–µ–∫—Å—Ç—ã –∫ —é–Ω–∏–∫–æ–¥—É –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞, —Ç–∞–∫ –∫–∞–∫ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –æ—Å—Ç–∞–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω–Ω–∏—Ü–∞. –Æ–Ω–∏–∫–æ–¥  —Å–∏–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç  –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç—Ä–µ–±–ª—è–µ–º–æ–π –ø–∞–º—è—Ç–∏.</s></font>

# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞: </b></font> ‚ùå\
# <font color='red'><s> –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ, –ª–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. pymystem —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞, –∏ –∑–¥–µ—Å—å –±–µ—Å–ø–æ–ª–µ–∑–Ω–∞. –ü—Ä–æ –¥—Ä—É–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ª–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏–∏ (Wordnet Lemmatizer –∏–ª–∏ Spacy Lemmatizer) –º–æ–∂–Ω–æ –ø–æ—á–∏—Ç–∞—Ç—å [—Ç—É—Ç](https://webdevblog.ru/podhody-lemmatizacii-s-primerami-v-python/). –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ POS-—Ç–µ–≥–∏. –î–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ª–µ–º–º–∞—Ç–∏–∑–∞—Ç–æ—Ä–æ–≤ –æ–Ω–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã.</s></font>

# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞: </b></font> \
# <font color='purple'> C–ø–∞—Å–∏–±–æ –ø–æ–ø—Ä–∞–≤–∏–ª.</font>

# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ 2: </b></font> ‚ùå\
# <font color='red'><s>–û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ, –õ–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–µ–≤–æ–π —Å—Ç—Ä–æ—á–∫–∏ –∫–æ—Ä–ø—É—Å–∞ (lemmatize(train_corpus[0]),\
# –ò —Å–ª–æ–≤–∞ —Å–∫–ª–µ–∏–ª–∏—Å—å –≤ –æ–¥–Ω–æ. –ù—É–∂–Ω–æ –î–∂–æ–π–Ω–∏—Ç—å –æ—Ç–ª–µ–º–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞ –ø–æ –ø—Ä–æ–±–µ–ª—É `" ".join([token.lemma_ for token in doc])`.</s></font>

# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ 2: </b></font> ‚ö†Ô∏è\
# <font color='darkorange'> –õ–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—é –º–æ–∂–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –Ω–∞ –≤—Å—ë–º –∫–æ—Ä–ø—É—Å–µ —Ç–µ–∫—Å—Ç–æ–≤, –¥–æ —Ä–∞–∑–±–∏–µ–Ω–∏—è –Ω–∞ –≤—ã–±–æ—Ä–∫–µ. –¢–∞–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏, –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª—å—é, –ø–æ—ç—Ç–æ–º—É –ª–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–æ—Å–µ–¥–Ω–∏—Ö —Å–ª–æ–≤.</font>

# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞: </b></font>\
# <font color='blue'>–ü—Ä–∏—Å–º–æ—Ç—Ä–∏—Å—å –∫ spaCy - —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –∏ –∫–æ–¥–∞ –º–µ–Ω—å—à–µ.</font>

# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞: </b></font> ‚ö†Ô∏è\
# <font color='darkorange'> –õ–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—é –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –Ω–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö. –í–Ω—É—Ç—Ä–∏ –∏–¥—ë—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞ –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏.</font>

# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞ 2: </b></font> \
# <font color='purple'> C–ø–∞—Å–∏–±–æ –ø–æ–ø—Ä–∞–≤–∏–ª.</font>

# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ 3: </b></font> ‚úîÔ∏è\
# <font color='green'> –û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –≤–∏–¥–Ω–æ, —á—Ç–æ —Å–ª–æ–≤–∞ –≤ –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ö.</font>

# In[17]:


stopwords = set(nltk_stopwords.words('english'))
count_tf_idf = TfidfVectorizer(stop_words=stopwords, ngram_range=(1,1))
tf_idf_train = count_tf_idf.fit_transform(features_train)


# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞: </b></font> ‚úîÔ∏è\
# <font color='green'> –£–±—Ä–∞–ª–∏ —á–∞—Å—Ç—ã–µ –Ω–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–ª–æ–≤–∞!</font>

# In[18]:


tf_idf_valid = count_tf_idf.transform(features_valid)


# In[19]:


tf_idf_test = count_tf_idf.transform(features_test)


# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞: </b></font> ‚úîÔ∏è\
# <font color='green'> –ö–ª–∞—Å—Å–Ω–æ, —á—Ç–æ –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ç–æ—Ä –±—ã–ª –æ–±—É—á–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–π —á–∞—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö!</font>

# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞: </b></font> ‚ö†Ô∏è\
# <font color='darkorange'> –ú–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ç–æ—Ä —Å –º–æ–¥–µ–ª—å—é —á–µ—Ä–µ–∑ Pipeline. –¢–∞–∫ –º–æ–∂–Ω–æ –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–µ–∫ –¥–∞–∂–µ –ø—Ä–∏ –∫—Ä–æ—Å—Å–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π.<br> –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ Pipeline:<br> [–û –ü–∞–π–ø–ª–∞–π–Ω](https://www.helenkapatsa.ru/paiplain/)<br>
# 
# [–ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–∫—Å—Ç–∞–º–∏](https://scikit-learn.org/stable/auto_examples/model_selection/plot_grid_search_text_feature_extraction.html)</font>

# ## –û–±—É—á–µ–Ω–∏–µ

# ### LogisticRegression

# In[20]:


lr = LogisticRegression(random_state=1, solver='liblinear', max_iter=100)
params = {
   'penalty':['l1', 'l2'],        
   'C':list(range(1,15,3)) 
}



lr_gs = GridSearchCV(lr, params, cv=3, scoring='f1', verbose=True).fit(tf_idf_train, target_train)

print ("Best Params", lr_gs.best_params_)
print ("Best Score", lr_gs.best_score_)


# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ : </b></font> ‚úîÔ∏è\
# <font color='green'>–ü–æ–¥–±–æ—Ä –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–æ–≤–µ–¥—ë–Ω –≤–µ—Ä–Ω–æ.</font>

# In[21]:


lr_best = LogisticRegression(random_state=1, class_weight = 'balanced', C = 4, penalty = 'l1', solver='liblinear', max_iter=100)
lr_best.fit(tf_idf_train, target_train)


# –ü—Ä–æ–≤–µ—Ä–∏–º –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ

# In[22]:


pred1 = lr_best.predict(tf_idf_valid)
f1_score(target_valid, pred1)


# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞: </b></font> ‚úîÔ∏è\
# <font color='green'>üëç</font>

# ### DecisionTreeClassifier

# In[ ]:


tree = DecisionTreeClassifier(random_state = 123)
params = {
   'criterion':['gini', 'entropy'],        
   'max_depth':list(range(1,15,5)) 
}



tree_gs = GridSearchCV(tree, params, cv=3, scoring='f1', verbose=True).fit(tf_idf_train, target_train)

print ("Best Params", tree_gs.best_params_)
print ("Best Score", tree_gs.best_score_)


# –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä–∏–º –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ

# In[ ]:


tree_best = DecisionTreeClassifier(random_state = 123, criterion='gini', max_depth=11)
tree_best.fit(tf_idf_train, target_train)
pred2 = tree_best.predict(tf_idf_valid)
f1_score(target_valid, pred2)


# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞: </b></font> ‚úîÔ∏è\
# <font color='green'>üëç</font>

# –ù–∞–π–¥–µ–º –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ LogisticRegression(–µ—ë —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ª—É—á—à–µ)

# In[ ]:


pred1 = lr_best.predict(tf_idf_test)      
f1_lr = f1_score(target_test, pred1)     
f1_lr


# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞: </b></font> ‚úîÔ∏è\
# <font color='green'>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–æ –≤–µ—Ä–Ω–æ.</font>

# ## –í—ã–≤–æ–¥—ã

# –ó–Ω–∞—á–µ–Ω–∏–µ F1 –±–æ–ª—å—à–µ 0.75, —á—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ —Å –∑–∞–¥–∞–Ω–∏–µ–º –Ω–∞—à–∞ –º–æ–¥–µ–ª—å —Å–ø—Ä–∞–≤–∏–ª–∞—Å—å! –õ—É—á—à–∞—è –º–æ–¥–µ–ª—å - LogisticRegression —Å –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ C = 4, penalty = 'l1'.

# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞: </b></font> ‚úîÔ∏è\
# <font color='green'> –û—á–µ–Ω—å –ø—Ä–∏—è—Ç–Ω–æ –≤–∏–¥–µ—Ç—å –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Ü–µ –ø—Ä–æ–µ–∫—Ç–∞!\
# –ü—Ä–∏–≤–µ–¥–µ–Ω—ã –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≥–ª–∞–≤–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ–µ–∫—Ç–∞.</font>

# <font color='blue'><b>–ò—Ç–æ–≥–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>\
# <font color='green'>–°–µ—Ä–≥–µ–π, —Ö–æ—Ä–æ—à–∏–π –ø—Ä–æ–µ–∫—Ç –ø–æ–ª—É—á–∏–ª—Å—è!
# –ë–æ–ª—å—à–æ–µ —Å–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É. –í–∏–¥–Ω–æ, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–æ –º–Ω–æ–≥–æ —É—Å–∏–ª–∏–π.
# </font>
# 
# <font color='blue'>–ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:</font>
# <ul><font color='red'>–ù–µ –ø—Ä–∏–º–µ–Ω—è–π –Æ–Ω–∏–∫–æ–¥ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤ –Ω–∞ –ª–∞—Ç–∏–Ω–∏—Ü–µ.</font></ul>
# <ul><font color='red'>–ù–µ –ø—Ä–∏–º–µ–Ω—è–π pymystem –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤ –Ω–∞ –ê–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ.</font></ul>
# 
# <font color='blue'>–ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ª—É—á—à–µ:</font>
# <font color='orange'>–í —Ä–∞–±–æ—Ç–µ —è –æ—Å—Ç–∞–≤–∏–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–≤–µ—Ç–æ–≤. –ë—É–¥—É —Ä–∞–¥, –µ—Å–ª–∏ —Ç—ã —É—á—Ç–µ—à—å –∏—Ö.</font></ul>
# 
# <font color='blue'><b>–ñ–¥—É –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –ø—Ä–æ–µ–∫—Ç–∞ :)</b></font>

# <font color='blue'><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞: </b></font> \
# <font color='purple'> –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è –ø–æ–¥–æ–±—Ä–∞–ª –æ—á–µ–Ω—å –∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∏.</font>

# <font color='blue'><b>–ò—Ç–æ–≥–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ 2</b></font>\
# <font color='green'>–°–µ—Ä–≥–µ–π, –±–æ–ª—å—à–æ–µ —Å–ø–∞—Å–∏–±–æ –∑–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É. –£–±—Ä–∞–ª–∏ –Æ–Ω–∏–∫–æ–¥, –ø—Ä–∏–º–µ–Ω–∏–ª–∏ SpaCy.
# </font>
# 
# <font color='blue'>–ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:</font>
# <ul><font color='red'>–ü–æ–ø—Ä–∞–≤—å –õ–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—é.</font></ul>
# 
# <font color='blue'>–ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ª—É—á—à–µ:</font>
# <font color='orange'>–í —Ä–∞–±–æ—Ç–µ —è –æ—Å—Ç–∞–≤–∏–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–≤–µ—Ç–æ–≤. –ë—É–¥—É —Ä–∞–¥, –µ—Å–ª–∏ —Ç—ã —É—á—Ç–µ—à—å –∏—Ö.</font></ul>
# 
# <font color='blue'><b>–ñ–¥—É –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –ø—Ä–æ–µ–∫—Ç–∞ :)</b></font>

# <font color='blue'><b>–ò—Ç–æ–≥–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ 2</b></font>\
# <font color='green'> –°–µ—Ä–≥–µ–π, –ø—Ä–æ–µ–∫—Ç –ø—Ä–∏–Ω—è—Ç! \
# –í—Å–µ —ç—Ç–∞–ø—ã –ø—Ä–æ–π–¥–µ–Ω—ã. –í—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —É—á—Ç–µ–Ω—ã.\
# –ù–∞–¥–µ—é—Å—å, —Ç–µ–±–µ –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è –ø—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.</font> \
# <font color='blue'><b>–°–ø–∞—Å–∏–±–æ, —É–¥–∞—á–∏ –≤ –æ—Å–≤–æ–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏!</b></font>

# <font color='green'><b>–ü–æ–ª–µ–∑–Ω—ã–µ (–∏ –ø—Ä–æ—Å—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ) –º–∞—Ç–µ—Ä–∏–∞–ª—ã:</b> \
# –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–∫—Å—Ç–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏ –¥—Ä—É–≥–∏–µ –ø–æ–¥—Ö–æ–¥—ã. –ù–∞–ø—Ä–∏–º–µ—Ä, —Å–µ–π—á–∞—Å –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è RNN (LSTM) –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä—ã (BERT –∏ –¥—Ä—É–≥–∏–µ —Å —É–ª–∏—Ü—ã –°–µ–∑–∞–º, –Ω–∞–ø—Ä–∏–º–µ—Ä, ELMO). –ù–û! –û–Ω–∏ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –ø–∞–Ω–∞—Ü–µ–µ–π, –Ω–µ –≤—Å–µ–≥–¥–∞ –æ–Ω–∏ –Ω—É–∂–Ω—ã, —Ç–∞–∫ –∫–∞–∫ –∏ TF-IDF –∏–ª–∏ Word2Vec + –º–æ–¥–µ–ª–∏ –∏–∑ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ ML —Ç–æ–∂–µ –º–æ–≥—É—Ç —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è. \
# BERT —Ç—è–∂–µ–ª—ã–π, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –º–Ω–æ–≥–æ –µ–≥–æ –≤–∞—Ä–∏–∞—Ü–∏–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á, –µ—Å—Ç—å –≥–æ—Ç–æ–≤—ã–µ –º–æ–¥–µ–ª–∏, –µ—Å—Ç—å –Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞–¥ –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π transformers. –ï—Å–ª–∏, –æ–±—É—á–∞—Ç—å BERT –Ω–∞ GPU (–º–æ–∂–Ω–æ –≤ Google Colab –∏–ª–∏ Kaggle), —Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–±—ã—Å—Ç—Ä–µ–µ.\
# https://huggingface.co/transformers/model_doc/bert.html \
# https://colah.github.io/posts/2015-08-Understanding-LSTMs/ - –ü—Ä–æ LSTM \
# https://web.stanford.edu/~jurafsky/slp3/10.pdf - –ø—Ä–æ —ç–Ω–∫–æ–¥–µ—Ä-–¥–µ–∫–æ–¥–µ—Ä –º–æ–¥–µ–ª–∏, —ç—Ç–µ–Ω—à–µ–Ω—ã\
# https://pytorch.org/tutorials/beginner/transformer_tutorial.html - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –≥–∞–π–¥
# –ø–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä—É –æ—Ç —Å–æ–∑–¥–∞—Ç–µ–ª–µ–π pytorch\
# https://transformer.huggingface.co/ - –ø–æ–±–æ–ª—Ç–∞—Ç—å —Å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–æ–º \
# –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏: allennlp, fairseq, transformers, tensorflow-text ‚Äî –º–Ω–æ–∂–µ—Å—Ç–≤–æ—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
# –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–æ–≤ –º–µ—Ç–æ–¥–æ–≤ NLP \
# Word2Vec https://radimrehurek.com/gensim/models/word2vec.html
# 
# <font color='green'>–ü—Ä–∏–º–µ—Ä BERT —Å GPU:
# ```python
# %%time
# from tqdm import notebook
# batch_size = 2 # –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ –≤–æ–∑—å–º–µ–º —Ç–∞–∫–æ–π –±–∞—Ç—á, –≥–¥–µ –±—É–¥–µ—Ç –≤—Å–µ–≥–æ –¥–≤–µ —Å—Ç—Ä–æ–∫–∏ –¥–∞—Ç–∞—Å–µ—Ç–∞
# embeddings = []
# for i in notebook.tqdm(range(input_ids.shape[0] // batch_size)):
#         batch = torch.LongTensor(input_ids[batch_size*i:batch_size*(i+1)]).cuda() # –∑–∞–∫–∏–¥—ã–≤–∞–µ–º —Ç–µ–Ω–∑–æ—Ä –Ω–∞ GPU
#         attention_mask_batch = torch.LongTensor(attention_mask[batch_size*i:batch_size*(i+1)]).cuda()
# 
#         with torch.no_grad():
#             model.cuda()
#             batch_embeddings = model(batch, attention_mask=attention_mask_batch)
# 
#         embeddings.append(batch_embeddings[0][:,0,:].cpu().numpy()) # –ø–µ—Ä–µ–≤–æ–¥ –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –ø—Ä–æ—Ü, —á—Ç–æ–±—ã –≤ –Ω—É–º–ø–∞–π –∫–∏–Ω—É—Ç—å
#         del batch
#         del attention_mask_batch
#         del batch_embeddings
# 
# features = np.concatenate(embeddings)
# ```
# –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –Ω–∞–ª–∏—á–∏–µ GPU.\
# –ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–∫: ```device = torch.device("cuda:0") if torch.cuda.is_available() else torch.device("cpu")```\
# –¢–æ–≥–¥–∞ –≤–º–µ—Å—Ç–æ .cuda() –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å .to(device)
# 
# –ï—Å–ª–∏ –ø–æ–Ω—Ä–∞–≤–∏–ª–∞—Å—å —Ä–∞–±–æ—Ç–∞ —Å —Ç–µ–∫—Å—Ç–∞–º–∏, —Ç–æ –º–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—á–µ–Ω—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π (–Ω–æ –æ—á–µ–Ω—å-–æ—á–µ–Ω—å —Å–ª–æ–∂–Ω—ã–π) –∫—É—Ä—Å –ª–µ–∫—Ü–∏–π: https://github.com/yandexdataschool/nlp_course .
# 
#     
# NLP –æ—Ç Samsung https://stepik.org/course/54098/promo \
# NLP –æ—Ç Huawei https://ods.ai/tracks/nlp-course-spring-23
# </font>

# ## –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

# - [x]  Jupyter Notebook –æ—Ç–∫—Ä—ã—Ç
# - [x]  –í–µ—Å—å –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
# - [x]  –Ø—á–µ–π–∫–∏ —Å –∫–æ–¥–æ–º —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤ –ø–æ—Ä—è–¥–∫–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
# - [x]  –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã
# - [x]  –ú–æ–¥–µ–ª–∏ –æ–±—É—á–µ–Ω—ã
# - [x]  –ó–Ω–∞—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ *F1* –Ω–µ –º–µ–Ω—å—à–µ 0.75
# - [x]  –í—ã–≤–æ–¥—ã –Ω–∞–ø–∏—Å–∞–Ω—ã
